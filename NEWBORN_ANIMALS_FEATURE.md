# ميزة المواليد الجديدة 🍼 - Newborn Animals Feature

## 📋 نظرة عامة

تم تطوير نظام متكامل لإدارة **المواليد الجديدة** داخل المزرعة، بحيث يتم التفريق بين:
1. **الشراء من مورد خارجي** 🛒 - له تكلفة شراء
2. **المواليد الداخلية** 🍼 - بدون تكلفة شراء (التكلفة = 0)

---

## 🎯 المشكلة التي تم حلها

### قبل التطوير:
- كل استقبال يتطلب مورد
- لا يوجد تمييز بين الشراء والمواليد
- صعوبة في احتساب التكاليف الحقيقية

### بعد التطوير:
- ✅ تمييز واضح بين الشراء والمواليد
- ✅ المواليد لها تكلفة = 0
- ✅ احتساب صحيح للتكاليف والأرباح
- ✅ تتبع دقيق لمصدر الحيوانات

---

## 💡 المفهوم

### المواليد الجديدة:
- حيوانات ولدت **داخل المزرعة**
- لا يوجد مورد خارجي
- **تكلفة الشراء = 0**
- التكاليف الحقيقية (الأعلاف، العلاج) تُحتسب على **الدفعة الأم**

### مثال توضيحي:
```
الدفعة الأم: 10 أبقار فريزيان (شراء)
├── تكلفة الشراء: 250,000 ج
├── تكلفة الأعلاف: 50,000 ج
├── تكلفة العلاج: 10,000 ج
└── المواليد: 3 عجول (ولادة) 🍼
    ├── تكلفة الشراء: 0 ج
    ├── تكلفة الأعلاف: تُحتسب منفصلة
    └── تكلفة العلاج: تُحتسب منفصلة
```

---

## 🔄 كيفية الاستخدام

### طريقة 1: إضافة مواليد جديدة

1. **افتح صفحة الاستقبال**
   - اذهب إلى `/receptions`
   - اضغط "إضافة دفعة استقبال"

2. **اختر نوع الاستقبال**
   - سترى مربع في الأعلى: "شراء من مورد 🛒" أو "مواليد جديدة 🍼"
   - اضغط "تحويل لمواليد"

3. **املأ البيانات**
   - **نوع الحيوان**: اختر (أبقار، أغنام، إلخ)
   - **السلالة**: اختر السلالة أو اتركها فارغة
   - **عدد الحيوانات**: عدد المواليد
   - **الوزن الإجمالي**: وزن جميع المواليد
   - **المورد**: سيظهر تلقائياً "مواليد داخلية 🍼" (معطل)
   - **السعر**: سيكون 0 تلقائياً (معطل)

4. **احفظ**
   - يتم حفظ الدفعة بتكلفة = 0

### طريقة 2: الشراء من مورد (الطريقة العادية)

1. **افتح الفورم** واترك الوضع الافتراضي "شراء من مورد 🛒"
2. **املأ جميع البيانات** بما فيها المورد والسعر
3. **احفظ**

---

## 🎨 واجهة المستخدم

### مربع نوع الاستقبال

```
┌─────────────────────────────────────────────────────┐
│  🛒  شراء من مورد                    [تحويل لمواليد] │
│      استقبال دفعة من مورد خارجي                      │
└─────────────────────────────────────────────────────┘
```

**عند الضغط على "تحويل لمواليد":**

```
┌─────────────────────────────────────────────────────┐
│  🍼  مواليد جديدة                         [✓ مواليد] │
│      المواليد الداخلية - بدون تكلفة شراء            │
│                                                      │
│  ┌────────────────────────────────────────────┐     │
│  │ ℹ️  ملاحظة: المواليد الجديدة لها تكلفة = 0  │     │
│  │  ولا تحتاج مورد. يتم احتساب تكاليف الإنتاج │     │
│  │  (الأعلاف والعلاج) على الدفعة الأم.        │     │
│  └────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────┘
```

### حقل المورد (عند المواليد)

```
المصدر
┌─────────────────────────────────┐
│  مواليد داخلية 🍼               │  (معطل - أخضر)
└─────────────────────────────────┘
المواليد من داخل المزرعة - لا يوجد مورد خارجي
```

### حقل السعر (عند المواليد)

```
التكلفة الإجمالية (ج)
┌─────────────────────────────────┐
│  0                               │  (معطل - أخضر)
└─────────────────────────────────┘
🍼 المواليد ليس لها تكلفة شراء - التكلفة = 0
```

---

## 💻 التطبيق التقني

### 1. State Management

```typescript
const [isNewborn, setIsNewborn] = useState(false);
```

### 2. Auto-set Values for Newborns

```typescript
useEffect(() => {
  if (isNewborn) {
    form.setValue("totalPrice", "0");
    form.setValue("supplier", "مواليد داخلية");
  } else if (form.getValues("supplier") === "مواليد داخلية") {
    form.setValue("supplier", "");
  }
}, [isNewborn, form]);
```

### 3. Conditional Rendering

**حقل المورد:**
```typescript
{isNewborn ? (
  <Input 
    value="مواليد داخلية 🍼"
    readOnly
    className="bg-green-50 border-green-200 text-green-700"
  />
) : (
  // Combobox العادي للموردين
)}
```

**حقل السعر:**
```typescript
<Input 
  type="number" 
  readOnly={isNewborn}
  className={cn(
    "text-lg",
    isNewborn && "bg-green-50 border-green-200 text-green-700"
  )}
  {...field} 
/>
```

### 4. Toggle Button

```typescript
<Button
  type="button"
  variant={isNewborn ? "default" : "outline"}
  onClick={() => setIsNewborn(!isNewborn)}
>
  {isNewborn ? '✓ مواليد' : 'تحويل لمواليد'}
</Button>
```

---

## 📊 تأثير على التقارير

### تقرير المصروفات
- **الشراء من مورد**: يظهر في المصروفات بالقيمة الكاملة
- **المواليد**: لا تظهر في مصروفات الشراء (القيمة = 0)

### تقرير الربحية
- **الشراء**: الربح = الإيراد - تكلفة الشراء - التكاليف الأخرى
- **المواليد**: الربح = الإيراد - التكاليف فقط (بدون تكلفة شراء)

### تقرير أرصدة الموردين
- **الشراء**: يؤثر على رصيد المورد
- **المواليد**: لا يؤثر (لا يوجد مورد)

---

## 🎯 حالات الاستخدام

### حالة 1: مزرعة ألبان مع عجول جديدة

```
السيناريو:
- عندك 50 بقرة حلوب
- ولدت 15 عجل في الشهر
- تريد تسجيلهم كدفعة جديدة

الحل:
1. افتح فورم الاستقبال
2. حول لـ "مواليد جديدة"
3. نوع: أبقار
4. سلالة: فريزيان (نفس الأم)
5. العدد: 15
6. الوزن: 450 كجم (30 كجم × 15)
7. السعر: 0 (تلقائي)
8. احفظ
```

### حالة 2: مزرعة أغنام مع خراف جديدة

```
السيناريو:
- عندك 100 نعجة
- ولدت 80 خروف في موسم الولادة
- تريد تسجيلهم

الحل:
1. افتح فورم الاستقبال
2. حول لـ "مواليد جديدة"
3. نوع: أغنام
4. سلالة: برقي
5. العدد: 80
6. الوزن: 240 كجم (3 كجم × 80)
7. السعر: 0 (تلقائي)
8. احفظ
```

### حالة 3: شراء عادي من مورد

```
السيناريو:
- تريد شراء 20 بقرة من مورد

الحل:
1. افتح فورم الاستقبال
2. اترك "شراء من مورد" (الافتراضي)
3. املأ جميع البيانات
4. اختر المورد
5. أدخل السعر
6. احفظ
```

---

## 🔧 الميزات التقنية

### 1. التمييز البصري
- **الشراء**: أيقونة 🛒 + لون أزرق
- **المواليد**: أيقونة 🍼 + لون أخضر

### 2. الحماية من الأخطاء
- حقل السعر **معطل** للمواليد (لا يمكن تعديله)
- حقل المورد **معطل** للمواليد
- القيمة تُعيّن تلقائياً = 0

### 3. التوجيه الواضح
- رسائل توضيحية في كل خطوة
- ملاحظة تفصيلية عن نظام التكاليف
- تغيير النصوص حسب الوضع

### 4. المرونة
- **سهولة التبديل** بين الوضعين بزر واحد
- **لا حاجة لفورم منفصل** للمواليد
- **نفس الحقول** مع تعديلات بسيطة

---

## 📈 الفوائد

### 1. محاسبة دقيقة
✅ تكلفة صحيحة لكل دفعة  
✅ ربحية واقعية  
✅ تقارير مالية دقيقة  

### 2. إدارة أفضل
✅ تتبع مصدر كل حيوان  
✅ معرفة المواليد من المشتريات  
✅ تخطيط أفضل للإنتاج  

### 3. سهولة الاستخدام
✅ واجهة بديهية  
✅ تبديل سريع بزر واحد  
✅ رسائل توضيحية  

### 4. مرونة
✅ يدعم جميع أنواع الحيوانات  
✅ يعمل مع نظام السلالات  
✅ متوافق مع جميع الميزات  

---

## 🚀 التطوير المستقبلي

### اقتراحات للمستقبل:

- [ ] **ربط المواليد بالأم**: تسجيل رقم الأم لكل مولود
- [ ] **تقرير المواليد**: تقرير خاص بالمواليد حسب النوع والفترة
- [ ] **معدل الولادة**: احتساب معدل الولادة لكل دفعة
- [ ] **صحة المواليد**: نسبة البقاء على قيد الحياة
- [ ] **جدول المواليد**: توقع المواليد القادمة
- [ ] **ربط بالدفعة الأم**: ربط المواليد بدفعة الأمهات تلقائياً
- [ ] **تحليل الإنتاجية**: كفاءة الإنتاج لكل سلالة

---

## 📝 ملاحظات مهمة

### ⚠️ نقاط يجب الانتباه لها:

1. **التكاليف المخفية**
   - المواليد لها تكلفة = 0 للشراء
   - لكن تحتاج تكاليف (أعلاف، علاج، إلخ)
   - هذه التكاليف تُسجل على الدفعة نفسها

2. **الأمهات**
   - تكاليف الأمهات (الأعلاف والعلاج) تُحتسب على دفعتهم
   - المواليد دفعة منفصلة بتكاليف منفصلة

3. **التقييم**
   - المواليد لها قيمة سوقية (سعر البيع)
   - لكن تكلفة الإنتاج = 0 + تكاليف التربية

4. **التقارير**
   - افصل بين المواليد والمشتريات في التحليل
   - المواليد مؤشر على كفاءة الإنتاج
   - المشتريات مؤشر على الاستثمار

---

## 📚 أمثلة عملية

### مثال 1: حساب ربحية المواليد

```
دفعة مواليد: 10 عجول فريزيان
├── تكلفة الشراء: 0 ج
├── تكلفة الأعلاف (6 شهور): 30,000 ج
├── تكلفة العلاج: 5,000 ج
├── تكاليف أخرى: 3,000 ج
├── إجمالي التكلفة: 38,000 ج
├── سعر البيع: 80,000 ج
└── الربح: 42,000 ج (110% نسبة ربح)
```

### مثال 2: مقارنة مواليد vs شراء

```
خيار 1: شراء 10 عجول
├── تكلفة الشراء: 60,000 ج
├── تكلفة التربية: 38,000 ج
├── إجمالي: 98,000 ج
└── الربح من البيع: 80,000 - 98,000 = -18,000 ج ❌

خيار 2: مواليد داخلية
├── تكلفة الشراء: 0 ج
├── تكلفة التربية: 38,000 ج
├── إجمالي: 38,000 ج
└── الربح من البيع: 80,000 - 38,000 = +42,000 ج ✅
```

**النتيجة**: المواليد الداخلية أكثر ربحية بكثير!

---

## 🎓 خلاصة

نظام المواليد الجديدة يوفر:
- ✅ **محاسبة دقيقة** للتكاليف والأرباح
- ✅ **تمييز واضح** بين الشراء والإنتاج الداخلي
- ✅ **سهولة استخدام** مع واجهة بديهية
- ✅ **تقارير صحيحة** تعكس الواقع
- ✅ **قرارات أفضل** بناءً على بيانات دقيقة

---

**تاريخ التطوير**: أكتوبر 2025  
**الحالة**: ✅ جاهز للاستخدام  
**الإصدار**: 1.0
