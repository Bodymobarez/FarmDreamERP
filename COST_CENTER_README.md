# مديول مركز التكلفة - Cost Center Module

## نظرة عامة
صفحة **مركز التكلفة** هي أداة شاملة لإدارة وتحليل التكاليف على ثلاثة مستويات:
1. **جميع الدفعات** - عرض شامل لكل الدفعات
2. **دفعة محددة** - تحليل تكاليف دفعة واحدة
3. **حيوان واحد** - تتبع تكاليف حيوان بعينه

## المميزات الرئيسية

### 1. المستويات الثلاثة للعرض
- **جميع الدفعات**: عرض ملخص لجميع الدفعات النشطة والمغلقة
- **دفعة محددة**: اختيار دفعة معينة لرؤية تفاصيل تكاليفها
- **حيوان واحد**: اختيار حيوان بعينه لتتبع تكاليفه الفردية

### 2. بطاقات الإحصائيات
- **إجمالي التكاليف**: مجموع كل التكاليف المسجلة
- **تكلفة الأعلاف**: إجمالي تكاليف الأعلاف
- **تكلفة العلاج**: إجمالي تكاليف العلاجات البيطرية
- **تكاليف أخرى**: مصاريف أخرى (عمالة، نقل، الخ)
- **متوسط التكلفة**: متوسط التكلفة لكل وحدة (دفعة أو حيوان)

### 3. جدول البيانات التفصيلي
يعرض الجدول:
- الاسم (اسم الدفعة أو رقم أذن الحيوان)
- النوع (دفعة أو حيوان)
- تكلفة الشراء الأولية
- تكلفة الأعلاف المتراكمة
- تكلفة العلاج المتراكمة
- التكاليف الأخرى
- الإجمالي الكلي
- الحالة (نشط/مغلق)
- زر "التفاصيل" لعرض المصروفات التفصيلية

### 4. إضافة مصروف جديد
نموذج شامل يتضمن:
- **اختيار الدفعة** (عند العرض على مستوى جميع الدفعات)
- **تاريخ المصروف**
- **نوع المصروف**: أعلاف، علاج، عمالة، نقل، أخرى
- **الوصف**: وصف تفصيلي للمصروف
- **الكمية وسعر الوحدة** (اختياري)
- **المبلغ الإجمالي**
- **طريقة الدفع**: نقدي، تحويل بنكي، شيك، آجل
- **ملاحظات إضافية**

### 5. نافذة التفاصيل
عند الضغط على "التفاصيل" تظهر نافذة منبثقة تحتوي على:
- **تقسيم التكاليف**: عرض مرئي لكل نوع من التكاليف
- **إجمالي التكلفة**: بطاقة مميزة بالمبلغ الإجمالي
- **سجل المصروفات التفصيلي**: جدول يعرض كل المصروفات المسجلة مع:
  - التاريخ
  - النوع
  - الوصف
  - الكمية
  - المبلغ

### 6. التصدير
يمكن تصدير البيانات إلى:
- **PDF**: ملف PDF جاهز للطباعة مع دعم العربية
- **Excel**: ملف .xlsx للتحليل في Excel
- **CSV**: ملف نصي للاستخدام في برامج أخرى

## كيفية الاستخدام

### 1. الوصول للصفحة
من القائمة الجانبية، اختر "مركز التكلفة"

### 2. اختيار مستوى العرض
1. اضغط على أحد الأزرار الثلاثة في الأعلى:
   - **جميع الدفعات**
   - **دفعة محددة**
   - **حيوان واحد**

2. إذا اخترت "دفعة محددة" أو "حيوان واحد"، سيظهر قائمة منسدلة لاختيار العنصر المطلوب

### 3. إضافة مصروف
1. اضغط على زر "إضافة مصروف"
2. املأ البيانات المطلوبة
3. اضغط "حفظ المصروف"

### 4. عرض التفاصيل
1. اضغط على زر "التفاصيل" بجانب أي عنصر في الجدول
2. ستظهر نافذة منبثقة بكل المعلومات التفصيلية
3. راجع سجل المصروفات الكامل

### 5. التصدير
1. اختر المستوى والعناصر التي تريد تصديرها
2. اضغط على أحد أزرار التصدير (PDF/Excel/CSV)
3. سيتم تحميل الملف تلقائياً

## البيانات المستخدمة

### من API Endpoints:
- `GET /api/batches` - جلب جميع الدفعات
- `GET /api/animals` - جلب جميع الحيوانات
- `GET /api/batch-expenses` - جلب المصروفات التفصيلية
- `POST /api/batch-expenses` - إضافة مصروف جديد

### حقول الدفعة (Batch):
- `batchName` - اسم الدفعة
- `purchaseCost` - تكلفة الشراء
- `feedCost` - تكلفة الأعلاف
- `treatmentCost` - تكلفة العلاج
- `otherExpenses` - المصروفات الأخرى
- `totalCost` - الإجمالي
- `totalAnimals` - عدد الحيوانات
- `status` - الحالة

### حقول الحيوان (Animal):
- `earTag` - رقم الأذن
- `purchaseCost` - تكلفة الشراء
- `accumulatedFeedCost` - تكلفة الأعلاف المتراكمة
- `accumulatedTreatmentCost` - تكلفة العلاج المتراكمة
- `accumulatedOtherCost` - التكاليف الأخرى المتراكمة
- `totalCost` - الإجمالي
- `batchId` - الدفعة التابع لها

### حقول المصروف (Batch Expense):
- `batchId` - رقم الدفعة
- `expenseDate` - تاريخ المصروف
- `expenseType` - نوع المصروف (feed, treatment, labor, transport, other)
- `description` - الوصف
- `quantity` - الكمية
- `unitPrice` - سعر الوحدة
- `amount` - المبلغ الإجمالي
- `paymentMethod` - طريقة الدفع
- `notes` - ملاحظات

## الملفات المعنية

### Frontend:
- `client/src/pages/CostCenter.tsx` - الصفحة الرئيسية
- `client/src/components/app-sidebar.tsx` - القائمة الجانبية (تم تحديث الرابط)
- `client/src/App.tsx` - التوجيه (تم إضافة المسار)
- `client/src/lib/exportUtils.ts` - دوال التصدير

### Backend:
- `server/routes.ts` - API endpoints للمصروفات
- `server/storage.ts` - طرق التخزين والاسترجاع
- `shared/schema.ts` - تعريفات الـ Types والـ Validation

## ملاحظات تقنية

1. **التحديث التلقائي**: عند إضافة مصروف، يتم تحديث البيانات تلقائياً باستخدام TanStack Query
2. **التحقق من البيانات**: كل الحقول المطلوبة مميزة بنجمة (*)
3. **دعم العربية**: كل النصوص والتصدير يدعم اللغة العربية بالكامل
4. **الاستجابة**: التصميم متجاوب ويعمل على جميع الأحجام

## التطويرات المستقبلية المقترحة

1. **الرسوم البيانية**: إضافة رسوم بيانية لتوضيح توزيع التكاليف
2. **المقارنات**: مقارنة تكاليف دفعات مختلفة
3. **التنبؤات**: حساب التكاليف المتوقعة
4. **الميزانية**: تحديد ميزانية وتتبع الالتزام بها
5. **التقارير المجدولة**: إرسال تقارير دورية تلقائياً
6. **الربط بالمحاسبة**: ربط مباشر بنظام المحاسبة العامة

---

تم التطوير بواسطة: Farm Dream ERP Team
التاريخ: 2025
