# 💰 دليل موديول المصروفات المتطور - FarmDreamERP

## 📋 نظرة عامة

تم تطوير موديول المصروفات ليصبح نظاماً شاملاً لإدارة جميع أنواع المصروفات في المزرعة، بما في ذلك **نظام المرتبات** الكامل.

---

## ✨ المميزات الجديدة

### 🎯 1. أنواع المصروفات الشاملة (15 نوع)

| الأيقونة | النوع | الوصف | أمثلة |
|---------|-------|-------|-------|
| 🌾 | **أعلاف** | تكاليف الأعلاف والتغذية | علف مركز، برسيم، تبن، شعير |
| 💊 | **أدوية وعلاجات** | المصروفات الطبية البيطرية | تطعيمات، أدوية، علاجات، فيتامينات |
| 👥 | **مرتبات** | رواتب الموظفين والعمالة | رواتب شهرية، أجور، حوافز |
| ⚡ | **مرافق** | خدمات الكهرباء والمياه والغاز | فواتير كهرباء، مياه، غاز |
| 🔧 | **صيانة** | صيانة المباني والمعدات | إصلاحات، صيانة دورية، قطع غيار |
| 🚚 | **نقل ومواصلات** | تكاليف النقل والمواصلات | وقود، نقل حيوانات، نقل أعلاف |
| 🏠 | **إيجار** | إيجار الأراضي والمباني | إيجار مزرعة، عنابر، مخازن |
| 🛡️ | **تأمين** | بوالص التأمين | تأمين حيوانات، مباني، معدات |
| 📢 | **تسويق** | مصروفات الدعاية والإعلان | إعلانات، مطبوعات، تسويق إلكتروني |
| 📋 | **استشارات** | خدمات استشارية | استشارات بيطرية، إدارية، زراعية |
| 🛠️ | **معدات وأدوات** | شراء معدات جديدة | أدوات، معدات، أجهزة |
| ✨ | **تنظيف ونظافة** | مستلزمات النظافة | مواد تنظيف، تطهير، مبيدات |
| 🔒 | **أمن وحراسة** | خدمات الأمن والحراسة | حراس، كاميرات، أنظمة أمنية |
| 📊 | **ضرائب ورسوم** | الضرائب والرسوم الحكومية | ضرائب، رسوم ترخيص، جمارك |
| 📦 | **أخرى** | مصروفات متنوعة | أي مصروفات غير مصنفة |

---

## 💼 نظام المرتبات المتكامل

### 🎯 المميزات الرئيسية

#### 1️⃣ **جدول الموظفين (Employees Table)**

```typescript
employees {
  id: UUID
  employeeNumber: string        // رقم الموظف (فريد)
  employeeName: string          // الاسم الكامل
  position: string              // الوظيفة
  department: string            // القسم
  
  // معلومات الاتصال
  phone: string
  email: string
  address: text
  
  // معلومات التوظيف
  hireDate: timestamp           // تاريخ التعيين
  contractType: enum            // full_time, part_time, contract
  status: enum                  // active, inactive, resigned, terminated
  
  // معلومات الراتب
  baseSalary: decimal           // الراتب الأساسي
  allowances: decimal           // البدلات الثابتة
  
  // معلومات البنك
  bankName: string
  bankAccountNumber: string
  
  // معلومات قانونية
  nationalId: string            // الرقم القومي
  taxNumber: string             // الرقم الضريبي
  socialInsuranceNumber: string // رقم التأمينات
  
  notes: text
  createdAt: timestamp
  updatedAt: timestamp
}
```

#### 2️⃣ **نموذج الراتب في المصروفات**

عند إضافة راتب، يتم تسجيل:

```typescript
expense {
  // معلومات أساسية
  expenseType: "salary"
  category: "👥 مرتبات"
  expenseDate: Date
  amount: decimal               // إجمالي المبلغ المدفوع
  
  // بيانات الموظف
  employeeName: string          // اسم الموظف
  employeePosition: string      // الوظيفة
  employeeId: string            // رقم الموظف (اختياري)
  
  // تفاصيل الراتب
  salaryMonth: string           // شهر الراتب (YYYY-MM)
  baseSalary: decimal           // الراتب الأساسي
  bonuses: decimal              // الحوافز والبدلات
  deductions: decimal           // الخصومات
  netSalary: decimal            // صافي الراتب (محسوب تلقائياً)
  
  // معلومات الدفع
  paymentMethod: enum           // cash, bank_transfer, check
  referenceNumber: string       // رقم الشيك أو الحوالة
  
  description: text
  notes: text
}
```

#### 3️⃣ **حسابات الراتب التلقائية**

```
صافي الراتب = الراتب الأساسي + الحوافز - الخصومات
Net Salary = Base Salary + Bonuses - Deductions
```

**مثال:**
- الراتب الأساسي: 5,000 ج
- الحوافز: 1,000 ج
- الخصومات: 500 ج
- **صافي الراتب: 5,500 ج** ✅

---

## 🗄️ هيكل قاعدة البيانات

### 📊 جدول المصروفات (Expenses)

```sql
CREATE TABLE expenses (
  id UUID PRIMARY KEY,
  expense_number VARCHAR(50) UNIQUE NOT NULL,
  expense_date TIMESTAMP NOT NULL,
  
  -- تصنيف المصروف
  category VARCHAR(50) NOT NULL,
  subcategory VARCHAR(100),
  expense_type VARCHAR(50) NOT NULL, -- feed, medicine, salary, etc.
  
  -- المبالغ
  amount DECIMAL(12,2) NOT NULL,
  quantity DECIMAL(10,2),
  unit_price DECIMAL(10,2),
  
  -- بيانات المرتبات
  employee_name VARCHAR(255),
  employee_position VARCHAR(100),
  employee_id VARCHAR(100),
  salary_month VARCHAR(7), -- YYYY-MM
  base_salary DECIMAL(10,2),
  bonuses DECIMAL(10,2) DEFAULT 0,
  deductions DECIMAL(10,2) DEFAULT 0,
  net_salary DECIMAL(10,2),
  
  -- ربط بجهات أخرى
  batch_id VARCHAR(255),
  supplier_id VARCHAR(255),
  
  -- طريقة الدفع
  payment_method VARCHAR(50),
  payment_status VARCHAR(20) DEFAULT 'paid',
  paid_amount DECIMAL(12,2),
  remaining_amount DECIMAL(12,2),
  reference_number VARCHAR(100),
  
  -- وصف وملاحظات
  description TEXT NOT NULL,
  notes TEXT,
  
  -- المرفقات
  attachments TEXT, -- JSON array
  
  -- تتبع
  created_by VARCHAR(255),
  approved_by VARCHAR(255),
  approved_at TIMESTAMP,
  
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

---

## 🎨 واجهة المستخدم المطورة

### ✨ نموذج إضافة مصروف جديد

#### 1️⃣ **اختيار نوع المصروف (Grid Cards)**

```
┌─────────────────────────────────────────────────────┐
│ 💰 إضافة مصروف جديد                                │
├─────────────────────────────────────────────────────┤
│                                                     │
│ نوع المصروف *                                      │
│ ┌────────────┬────────────┬────────────┐          │
│ │ 🌾 أعلاف   │ 💊 أدوية  │ 👥 مرتبات │          │
│ ├────────────┼────────────┼────────────┤          │
│ │ ⚡ مرافق    │ 🔧 صيانة  │ 🚚 نقل    │          │
│ ├────────────┼────────────┼────────────┤          │
│ │ 🏠 إيجار   │ 🛡️ تأمين  │ 📢 تسويق  │          │
│ ├────────────┼────────────┼────────────┤          │
│ │ 📋 استشارات│ 🛠️ معدات │ ✨ تنظيف  │          │
│ ├────────────┼────────────┼────────────┤          │
│ │ 🔒 أمن     │ 📊 ضرائب  │ 📦 أخرى   │          │
│ └────────────┴────────────┴────────────┘          │
└─────────────────────────────────────────────────────┘
```

#### 2️⃣ **الحقول العامة (All Expenses)**

```
┌─────────────────────────────────────┐
│ التاريخ *          │ المبلغ (ج) *  │
├────────────────────┼────────────────┤
│ 2025-10-11        │ 12,500        │
└────────────────────┴────────────────┘

┌────────────────────────────────────────┐
│ الوصف التفصيلي *                       │
├────────────────────────────────────────┤
│ علف تسمين مركز - 500 كجم              │
└────────────────────────────────────────┘

┌─────────────────────────────────────┐
│ طريقة الدفع    │ رقم المرجع       │
├─────────────────┼───────────────────┤
│ 💵 نقدي        │ -                 │
└─────────────────┴───────────────────┘
```

#### 3️⃣ **حقول المرتبات (عند اختيار "مرتبات")**

```
┌──────────────────────────────────────────────────┐
│ 👥 تفاصيل الراتب                                │
├──────────────────────────────────────────────────┤
│                                                  │
│ ┌────────────────────┬────────────────────────┐ │
│ │ اسم الموظف *      │ الوظيفة *             │ │
│ ├────────────────────┼────────────────────────┤ │
│ │ أحمد محمد          │ عامل تغذية            │ │
│ └────────────────────┴────────────────────────┘ │
│                                                  │
│ ┌────────────────────┬────────────────────────┐ │
│ │ رقم الموظف        │ شهر الراتب *          │ │
│ ├────────────────────┼────────────────────────┤ │
│ │ EMP-001           │ 2025-10               │ │
│ └────────────────────┴────────────────────────┘ │
│                                                  │
│ ┌────────────────────┬────────────────────────┐ │
│ │ الراتب الأساسي *  │ الحوافز والبدلات      │ │
│ ├────────────────────┼────────────────────────┤ │
│ │ 5,000 ج           │ 1,000 ج               │ │
│ └────────────────────┴────────────────────────┘ │
│                                                  │
│ ┌────────────────────┐                          │
│ │ الخصومات           │                          │
│ ├────────────────────┤                          │
│ │ 500 ج             │                          │
│ └────────────────────┘                          │
│                                                  │
│ ┌──────────────────────────────────────────┐   │
│ │ صافي الراتب:            5,500 ج         │   │
│ └──────────────────────────────────────────┘   │
└──────────────────────────────────────────────────┘
```

---

## 🚀 كيفية الاستخدام

### 📝 إضافة مصروف عادي (أعلاف مثلاً)

1. انقر على **"إضافة مصروف جديد"**
2. اختر **"🌾 أعلاف"**
3. أدخل البيانات:
   - التاريخ: `2025-10-11`
   - المبلغ: `12,500 ج`
   - الوصف: `علف تسمين مركز - 500 كجم`
   - طريقة الدفع: `نقدي`
4. انقر **"💾 حفظ المصروف"**

### 💼 إضافة راتب موظف

1. انقر على **"إضافة مصروف جديد"**
2. اختر **"👥 مرتبات"**
3. أدخل بيانات الموظف:
   - الاسم: `أحمد محمد`
   - الوظيفة: `عامل تغذية`
   - رقم الموظف: `EMP-001`
   - شهر الراتب: `2025-10`
4. أدخل تفاصيل الراتب:
   - الراتب الأساسي: `5,000 ج`
   - الحوافز: `1,000 ج`
   - الخصومات: `500 ج`
   - **صافي الراتب سيحسب تلقائياً: 5,500 ج** ✅
5. اختر طريقة الدفع: `تحويل بنكي`
6. انقر **"💾 حفظ المصروف"**

---

## 📊 التقارير والتحليلات

### 📈 تقارير المصروفات

#### 1️⃣ **ملخص المصروفات حسب النوع**

```
┌─────────────────────────────────────────────┐
│ 📊 ملخص المصروفات - أكتوبر 2025           │
├─────────────────┬──────────┬───────────────┤
│ النوع          │ المبلغ   │ النسبة       │
├─────────────────┼──────────┼───────────────┤
│ 🌾 أعلاف       │ 45,000 ج│ 40%          │
│ 👥 مرتبات      │ 30,000 ج│ 27%          │
│ 💊 أدوية       │ 15,000 ج│ 13%          │
│ ⚡ مرافق        │ 8,000 ج │ 7%           │
│ 🔧 صيانة       │ 7,000 ج │ 6%           │
│ 📦 أخرى        │ 7,500 ج │ 7%           │
├─────────────────┼──────────┼───────────────┤
│ الإجمالي       │ 112,500 ج│ 100%        │
└─────────────────┴──────────┴───────────────┘
```

#### 2️⃣ **تقرير المرتبات الشهرية**

```
┌──────────────────────────────────────────────────────┐
│ 💼 تقرير المرتبات - أكتوبر 2025                    │
├────────┬─────────┬─────────┬─────────┬──────────────┤
│ الموظف│ الوظيفة│ الأساسي │ الحوافز │ صافي الراتب │
├────────┼─────────┼─────────┼─────────┼──────────────┤
│ أحمد   │ تغذية  │ 5,000  │ 1,000  │ 5,500       │
│ محمود  │ رعاية  │ 4,500  │ 500    │ 4,800       │
│ سعيد   │ صيانة  │ 6,000  │ 1,500  │ 7,200       │
├────────┴─────────┴─────────┴─────────┼──────────────┤
│ الإجمالي                             │ 17,500 ج    │
└──────────────────────────────────────┴──────────────┘
```

---

## 🔧 التكامل مع الأنظمة الأخرى

### 🔗 1. ربط المصروفات بمراكز التكلفة (Batches)

```typescript
expense {
  expenseType: "feed",
  batchId: "BATCH-2025-001",  // ✅ ربط بالدفعة
  amount: 12500,
  description: "علف للدفعة رقم 1"
}
```

### 🔗 2. ربط المصروفات بالموردين

```typescript
expense {
  expenseType: "feed",
  supplierId: "SUPPLIER-001",  // ✅ ربط بالمورد
  amount: 12500,
  description: "علف من شركة الأهرام"
}
```

### 🔗 3. تحديث تكاليف الدفعة تلقائياً

عند إضافة مصروف مرتبط بدفعة، يتم:
- ✅ تحديث `feedCost` إذا كان النوع "أعلاف"
- ✅ تحديث `treatmentCost` إذا كان النوع "أدوية"
- ✅ تحديث `otherExpenses` للأنواع الأخرى
- ✅ إعادة حساب `totalCost` للدفعة

---

## 📱 واجهة صفحة المصروفات

### 🎯 بطاقات الإحصائيات

```
┌──────────────────────────────────────────────────┐
│ ┌────────────┬────────────┬────────────┐        │
│ │ 💰 إجمالي  │ 📈 أعلى   │ 📊 مقارنة │        │
│ │ المصروفات  │ فئة        │ بالماضي   │        │
│ │ 112,500 ج │ الأعلاف    │ +12%      │        │
│ │            │ 45,000 ج  │           │        │
│ └────────────┴────────────┴────────────┘        │
└──────────────────────────────────────────────────┘
```

### 📋 قائمة المصروفات

```
┌──────────────────────────────────────────────────┐
│ 📅 11/10/2025 │ 🌾 أعلاف      │ 12,500 ج      │
│ علف تسمين مركز - 500 كجم                       │
├──────────────────────────────────────────────────┤
│ 📅 10/10/2025 │ 👥 مرتبات     │ 5,500 ج       │
│ راتب أحمد محمد - أكتوبر 2025                   │
├──────────────────────────────────────────────────┤
│ 📅 09/10/2025 │ 💊 أدوية      │ 3,200 ج       │
│ تطعيمات وأدوية بيطرية                          │
└──────────────────────────────────────────────────┘
```

---

## 🎯 أفضل الممارسات

### ✅ للمصروفات العامة

1. **كن دقيقاً في الوصف**: اكتب وصفاً تفصيلياً واضحاً
2. **سجل رقم المرجع**: احفظ رقم الشيك أو الحوالة
3. **استخدم التصنيف الصحيح**: اختر نوع المصروف المناسب
4. **أرفق المستندات**: احفظ الفواتير والإيصالات

### ✅ للمرتبات

1. **راجع الحسابات**: تأكد من الراتب الأساسي + الحوافز - الخصومات
2. **وثق الشهر**: سجل شهر الراتب بدقة (YYYY-MM)
3. **رقم المرجع**: سجل رقم الحوالة البنكية
4. **احفظ إيصال الاستلام**: وثق استلام الموظف للراتب

---

## 📝 أمثلة عملية

### مثال 1: شراء أعلاف

```json
{
  "expenseType": "feed",
  "category": "🌾 أعلاف",
  "subcategory": "علف مركز",
  "amount": 12500,
  "quantity": 500,
  "unitPrice": 25,
  "description": "علف تسمين مركز - 500 كجم",
  "batchId": "BATCH-2025-001",
  "supplierId": "SUPPLIER-001",
  "paymentMethod": "cash",
  "date": "2025-10-11"
}
```

### مثال 2: راتب موظف

```json
{
  "expenseType": "salary",
  "category": "👥 مرتبات",
  "employeeName": "أحمد محمد علي",
  "employeePosition": "عامل تغذية",
  "employeeId": "EMP-001",
  "salaryMonth": "2025-10",
  "baseSalary": 5000,
  "bonuses": 1000,
  "deductions": 500,
  "netSalary": 5500,
  "amount": 5500,
  "description": "راتب شهر أكتوبر 2025",
  "paymentMethod": "bank_transfer",
  "referenceNumber": "TRX-20251011-001",
  "date": "2025-10-11"
}
```

### مثال 3: فاتورة كهرباء

```json
{
  "expenseType": "utilities",
  "category": "⚡ مرافق",
  "subcategory": "كهرباء",
  "amount": 2500,
  "description": "فاتورة كهرباء - أكتوبر 2025",
  "referenceNumber": "ELEC-2025-10",
  "paymentMethod": "bank_transfer",
  "date": "2025-10-11"
}
```

---

## 🔐 الصلاحيات والأمان

### 👤 صلاحيات المستخدمين

| الدور | إضافة | عرض | تعديل | حذف | اعتماد |
|------|------|-----|-------|-----|--------|
| مدير المزرعة | ✅ | ✅ | ✅ | ✅ | ✅ |
| محاسب | ✅ | ✅ | ✅ | ❌ | ✅ |
| موظف | ❌ | ✅ | ❌ | ❌ | ❌ |

### 🔒 تتبع التغييرات

كل مصروف يحتوي على:
- `createdBy`: المستخدم الذي أضاف المصروف
- `approvedBy`: المستخدم الذي اعتمد المصروف
- `approvedAt`: تاريخ الاعتماد
- `createdAt`: تاريخ الإنشاء
- `updatedAt`: تاريخ آخر تحديث

---

## 📊 التقارير المتقدمة

### 1️⃣ تحليل المصروفات الشهري

```
📈 اتجاه المصروفات - 2025

يناير:   95,000 ج  ████████████
فبراير:  102,000 ج ████████████▌
مارس:    88,000 ج  ███████████
أبريل:   110,000 ج █████████████▌
مايو:    98,000 ج  ████████████
يونيو:   115,000 ج ██████████████
يوليو:   105,000 ج █████████████
أغسطس:   120,000 ج ██████████████▌
سبتمبر:  112,500 ج █████████████▌
أكتوبر:  118,000 ج ██████████████
```

### 2️⃣ مقارنة المصروفات

```
┌────────────────────────────────────────────┐
│ مقارنة شهر أكتوبر                         │
├──────────────┬────────┬────────┬──────────┤
│ النوع       │ 2024   │ 2025   │ التغيير │
├──────────────┼────────┼────────┼──────────┤
│ أعلاف       │ 40,000 │ 45,000 │ +12.5%  │
│ مرتبات      │ 28,000 │ 30,000 │ +7.1%   │
│ أدوية       │ 12,000 │ 15,000 │ +25%    │
│ مرافق       │ 7,500  │ 8,000  │ +6.7%   │
└──────────────┴────────┴────────┴──────────┘
```

---

## 🎓 خلاصة

### ✨ المميزات الرئيسية

1. ✅ **15 نوع** من المصروفات المختلفة
2. ✅ **نظام مرتبات** كامل ومتكامل
3. ✅ **حسابات تلقائية** للرواتب
4. ✅ **واجهة سهلة** وبديهية
5. ✅ **تكامل كامل** مع الدفعات والموردين
6. ✅ **تقارير شاملة** وتحليلات دقيقة
7. ✅ **تتبع كامل** للتغييرات والاعتمادات

### 🚀 الفوائد

- 📊 **تحكم كامل** في جميع المصروفات
- 💼 **إدارة احترافية** للمرتبات
- 📈 **تحليلات دقيقة** للتكاليف
- 🔍 **شفافية** في السجلات المالية
- ⚡ **سرعة** في إدخال البيانات
- 🎯 **دقة** في الحسابات

---

**تاريخ التحديث:** 11 أكتوبر 2025  
**الإصدار:** 2.0  
**الحالة:** ✅ جاهز للاستخدام
