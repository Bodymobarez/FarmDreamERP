# 📊 وثائق نظام التقارير المالية - FarmDreamERP

## 🎯 نظرة عامة

تم تطوير نظام **التقارير المالية** كواحد من 8 وحدات فرعية تحت **موديول الحسابات**، ويوفر 8 تقارير مالية شاملة ومتكاملة تغطي جميع جوانب الأداء المالي للمزرعة.

---

## 📑 التقارير المتاحة (8 تقارير)

### 1️⃣ قائمة الدخل (الأرباح والخسائر) - Profit & Loss Statement
**الهدف:** عرض شامل للإيرادات والمصروفات وصافي الربح

**المحتويات:**
- **الإيرادات:**
  - مبيعات الحيوانات: 450,000 ج
  - إيرادات أخرى: 15,000 ج
  - **إجمالي الإيرادات:** 465,000 ج

- **المصروفات:**
  - الأعلاف: 180,000 ج (50%)
  - الرواتب: 85,000 ج (23.6%)
  - الأدوية: 35,000 ج (9.7%)
  - المرافق: 15,000 ج (4.2%)
  - الصيانة: 12,000 ج (3.3%)
  - النقل: 8,000 ج (2.2%)
  - أخرى: 25,000 ج (6.9%)
  - **إجمالي المصروفات:** 360,000 ج

- **صافي الربح:** 105,000 ج
- **هامش الربح:** 22.6%

**المميزات:**
- عرض تفصيلي لكل فئة مع النسب المئوية
- مؤشرات بصرية ملونة (أخضر للإيرادات، أحمر للمصروفات)
- شريط تقدم يوضح هامش الربح

---

### 2️⃣ الميزانية العمومية - Balance Sheet
**الهدف:** عرض الوضع المالي الكامل للمزرعة (الأصول، الخصوم، حقوق الملكية)

**المحتويات:**

#### 🏢 الأصول (2,105,000 ج)
**أصول متداولة (455,000 ج):**
- 💵 نقدية وما يعادلها: 150,000 ج
- 📦 مخزون: 220,000 ج
- 👥 ذمم مدينة (عملاء): 85,000 ج

**أصول ثابتة (1,650,000 ج):**
- 🏞️ أراضي: 500,000 ج
- 🏢 مباني ومنشآت: 350,000 ج
- ⚙️ معدات وآلات: 180,000 ج
- 🐄 قطيع حيوانات: 620,000 ج

#### 💳 الخصوم (595,000 ج)
**خصوم متداولة (195,000 ج):**
- 👥 ذمم دائنة (موردين): 120,000 ج
- 💳 قروض قصيرة الأجل: 75,000 ج

**خصوم طويلة الأجل (400,000 ج):**
- 🏦 قروض طويلة الأجل: 400,000 ج

#### 💼 حقوق الملكية (1,510,000 ج)
- 💼 رأس المال: 1,200,000 ج
- 📈 أرباح محتجزة: 310,000 ج

**المعادلة المحاسبية:**
```
الأصول = الخصوم + حقوق الملكية
2,105,000 = 595,000 + 1,510,000 ✅
```

**المميزات:**
- تصميم متوازن بعمودين (أصول على اليسار، خصوم وحقوق ملكية على اليمين)
- ترميز لوني (أزرق للأصول، أحمر للخصوم، أخضر لحقوق الملكية)
- أيقونات تعبيرية لكل بند
- التحقق من توازن المعادلة المحاسبية

---

### 3️⃣ قائمة التدفقات النقدية - Cash Flow Statement
**الهدف:** تتبع حركة النقد الوارد والصادر

**المحتويات:**

#### 💼 الأنشطة التشغيلية (+90,000 ج)
- متحصلات من المبيعات: +450,000 ج
- مدفوعات المصروفات: -360,000 ج

#### 📊 الأنشطة الاستثمارية (-130,000 ج)
- شراء معدات: -50,000 ج
- شراء حيوانات: -80,000 ج

#### 💰 الأنشطة التمويلية (-40,000 ج)
- سداد قروض: -25,000 ج
- مسحوبات المالك: -15,000 ج

**ملخص التغير في النقدية:**
- النقدية في بداية الفترة: 230,000 ج
- صافي التغير خلال الفترة: -80,000 ج
- **النقدية في نهاية الفترة:** 150,000 ج ✅

**المميزات:**
- تصنيف واضح حسب نوع النشاط
- ترميز لوني (أزرق للتشغيلية، بنفسجي للاستثمارية، برتقالي للتمويلية)
- عرض صافي التغير بشكل بارز

---

### 4️⃣ تقرير المصروفات التفصيلي - Detailed Expenses Report
**الهدف:** تحليل شامل لجميع أنواع المصروفات

**المحتويات:**

| الفئة | المبلغ | النسبة | عدد البنود | متوسط البند | الاتجاه |
|------|--------|--------|-----------|-------------|---------|
| أعلاف | 180,000 ج | 50% | 45 | 4,000 ج | ↑ +5% |
| رواتب | 85,000 ج | 23.6% | 12 | 7,083 ج | → +2% |
| أدوية | 35,000 ج | 9.7% | 28 | 1,250 ج | ↓ -3% |
| مرافق | 15,000 ج | 4.2% | 3 | 5,000 ج | → +1% |
| صيانة | 12,000 ج | 3.3% | 8 | 1,500 ج | ↑ +7% |
| نقل | 8,000 ج | 2.2% | 15 | 533 ج | → 0% |
| أخرى | 25,000 ج | 6.9% | 18 | 1,389 ج | ↓ +4% |
| **الإجمالي** | **360,000 ج** | **100%** | **129** | - | - |

**المميزات:**
- جدول تفاعلي مع hover effects
- عرض الاتجاه باستخدام أسهم ملونة:
  - ↑ أحمر = زيادة
  - ↓ أخضر = انخفاض
  - → رمادي = ثابت
- Badge للنسب المئوية
- حساب متوسط تكلفة البند

---

### 5️⃣ تقرير الإيرادات التفصيلي - Detailed Revenue Report
**الهدف:** تحليل مصادر الإيرادات والمبيعات

**المحتويات:**

#### 🐄 بيع عجول (62.2%)
- المبلغ: **280,000 ج**
- عدد العمليات: 35
- متوسط سعر البيع: 8,000 ج

#### 🐂 بيع أبقار (26.7%)
- المبلغ: **120,000 ج**
- عدد العمليات: 8
- متوسط سعر البيع: 15,000 ج

#### 📦 بيع منتجات ثانوية (11.1%)
- المبلغ: **50,000 ج**
- عدد العمليات: 125
- متوسط سعر البيع: 400 ج

**الإحصائيات:**
- إجمالي الإيرادات: **450,000 ج**
- إجمالي عمليات البيع: **168 عملية**

**المميزات:**
- تصميم بطاقات أنيقة بتدرجات خضراء
- Badge للنسب المئوية
- عرض متوسط سعر البيع لكل مصدر
- ملخص شامل بالإجمالي

---

### 6️⃣ أرصدة العملاء - Customer Balances
**الهدف:** كشف حساب العملاء والمستحقات

**المحتويات:**

| العميل | المبلغ المطلوب | المدفوع | إجمالي الفواتير | الحالة | التأخير |
|--------|----------------|----------|-----------------|--------|---------|
| أحمد محمود | 45,000 ج | 85,000 ج | 130,000 ج | 🔴 متأخر | ⚠️ 15 يوم |
| محمد علي | 28,000 ج | 52,000 ج | 80,000 ج | 🟡 جيد | ⚠️ 5 أيام |
| خالد حسن | 12,000 ج | 38,000 ج | 50,000 ج | 🟢 ممتاز | - |
| عمر السيد | 0 ج | 65,000 ج | 65,000 ج | ✅ مدفوع | - |
| **الإجمالي** | **85,000 ج** | **240,000 ج** | **325,000 ج** | - | - |

**المميزات:**
- أيقونة Users لكل عميل
- Badge ملون حسب الحالة:
  - 🔴 أحمر = متأخر
  - 🟡 رمادي = جيد/دفع جزئي
  - ✅ أخضر = مدفوع
- تحذير بأيقونة AlertCircle للتأخير
- إجمالي المتأخرات في الهيدر

---

### 7️⃣ أرصدة الموردين - Supplier Balances
**الهدف:** كشف حساب الموردين والمديونيات

**المحتويات:**

| المورد | المبلغ المستحق | المدفوع | إجمالي المشتريات | الحالة | التأخير |
|--------|----------------|----------|------------------|--------|---------|
| مورد الأعلاف الرئيسي | 85,000 ج | 295,000 ج | 380,000 ج | 🔴 متأخر | ⚠️ 20 يوم |
| شركة الأدوية البيطرية | 25,000 ج | 110,000 ج | 135,000 ج | 🟡 جيد | ⚠️ 7 أيام |
| مورد المعدات | 10,000 ج | 90,000 ج | 100,000 ج | 🟢 ممتاز | ⚠️ 2 يوم |
| محطة الوقود | 0 ج | 45,000 ج | 45,000 ج | ✅ مدفوع | - |
| **الإجمالي** | **120,000 ج** | **540,000 ج** | **660,000 ج** | - | - |

**المميزات:**
- أيقونة Package لكل مورد
- Badge ملون حسب الحالة
- تحذير بأيقونة AlertCircle للتأخير
- إجمالي المستحقات في الهيدر (Badge أحمر)

---

### 8️⃣ تقرير مراكز التكلفة - Cost Centers Report
**الهدف:** تحليل الربحية حسب الدفعات (Batches)

**المحتويات:**

#### 🟢 دفعة أكتوبر 2025 (هامش ربح 20.8%)
- عدد الحيوانات: 150 رأس
- الإيرادات: 120,000 ج
- المصروفات: 95,000 ج
- **صافي الربح:** 25,000 ج
- **ربح للرأس:** 167 ج

#### 🔵 دفعة سبتمبر 2025 (هامش ربح 20.4%)
- عدد الحيوانات: 120 رأس
- الإيرادات: 98,000 ج
- المصروفات: 78,000 ج
- **صافي الربح:** 20,000 ج
- **ربح للرأس:** 167 ج

#### 🔵 دفعة أغسطس 2025 (هامش ربح 17.2%)
- عدد الحيوانات: 180 رأس
- الإيرادات: 145,000 ج
- المصروفات: 120,000 ج
- **صافي الربح:** 25,000 ج
- **ربح للرأس:** 139 ج

#### 🟠 دفعة يوليو 2025 (هامش ربح 14.7%)
- عدد الحيوانات: 100 رأس
- الإيرادات: 102,000 ج
- المصروفات: 87,000 ج
- **صافي الربح:** 15,000 ج
- **ربح للرأس:** 150 ج

**الإحصائيات الإجمالية:**
- إجمالي الحيوانات: **550 رأس**
- إجمالي الإيرادات: **465,000 ج**
- إجمالي المصروفات: **380,000 ج**
- صافي الربح: **85,000 ج**
- **متوسط هامش الربح:** **18.3%**

**المميزات:**
- ترميز لوني حسب الأداء:
  - 🟢 أخضر = هامش ربح ≥ 25% (ممتاز)
  - 🔵 أزرق = هامش ربح ≥ 15% (جيد)
  - 🟠 برتقالي = هامش ربح < 15% (يحتاج تحسين)
- Badge ملون بهامش الربح
- شريط تقدم بصري
- Grid Cards تعرض الأرقام الأساسية الأربعة
- حساب ربح للرأس الواحد

---

## 🎨 المميزات العامة لجميع التقارير

### 1️⃣ التصميم والواجهة
- **تصميم موحد ومتناسق:** جميع التقارير تستخدم نفس النمط البصري
- **ألوان معبرة:** استخدام نظام ألوان منطقي:
  - 🟢 أخضر = إيرادات/أرباح/إيجابي
  - 🔴 أحمر = مصروفات/خسائر/سلبي
  - 🔵 أزرق = أصول/معلومات
  - 🟣 بنفسجي = استثمارات
  - 🟠 برتقالي = تحذيرات
- **أيقونات Lucide React:** أكثر من 10 أيقونات معبرة
- **Badges:** لعرض النسب والحالات
- **Cards:** تصميم بطاقات أنيق مع shadows و borders

### 2️⃣ التفاعلية
- **Tabs Navigation:** التنقل السريع بين التقارير الـ 8
- **Hover Effects:** تأثيرات عند المرور على الصفوف
- **Responsive Design:** يعمل على جميع الأحجام
- **Color Indicators:** مؤشرات لونية فورية

### 3️⃣ الفلاتر والخيارات
- **فلتر الفترة الزمنية:**
  - اليوم
  - هذا الأسبوع
  - هذا الشهر
  - هذا الربع
  - هذه السنة
  - فترة مخصصة

- **اختيار نوع التقرير:** Dropdown بـ 8 خيارات

### 4️⃣ أدوات الإجراءات
- **زر طباعة:** لطباعة التقارير مباشرة
- **زر تصدير Excel:** لتصدير البيانات إلى Excel
- **أيقونات معبرة:** Printer و Download

---

## 🏗️ البنية التقنية

### المكونات المستخدمة (shadcn/ui)
```typescript
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Badge } from "@/components/ui/badge";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
```

### الأيقونات (Lucide React)
```typescript
import {
  BarChart3,      // الميزانية
  TrendingUp,     // الأرباح
  TrendingDown,   // المصروفات
  DollarSign,     // التدفقات النقدية
  FileText,       // أرصدة
  Download,       // تصدير
  Printer,        // طباعة
  Calendar,       // التاريخ
  PieChart,       // مراكز التكلفة
  LineChart,      // الإيرادات
  Building2,      // الأصول
  Wallet,         // الخصوم
  Users,          // العملاء
  Package,        // الموردين
  AlertCircle     // تحذيرات
} from "lucide-react";
```

### هياكل البيانات

#### قائمة الدخل
```typescript
const profitLossData = {
  revenue: {
    sales: 450000,
    otherIncome: 15000,
    total: 465000
  },
  expenses: {
    feed: 180000,
    salaries: 85000,
    medicine: 35000,
    utilities: 15000,
    maintenance: 12000,
    transport: 8000,
    other: 25000,
    total: 360000
  },
  netProfit: 105000
};
```

#### الميزانية العمومية
```typescript
const balanceSheetData = {
  assets: {
    current: { cash, inventory, receivables, total },
    fixed: { land, buildings, equipment, animals, total },
    total
  },
  liabilities: {
    current: { payables, shortTermLoans, total },
    longTerm: { loans, total },
    total
  },
  equity: {
    capital, retainedEarnings, total
  }
};
```

#### التدفقات النقدية
```typescript
const cashFlowData = {
  operating: { salesReceipts, expensePayments, total },
  investing: { equipmentPurchase, animalPurchase, total },
  financing: { loanRepayment, ownerWithdrawal, total },
  netChange,
  beginningCash,
  endingCash
};
```

#### المصروفات التفصيلية
```typescript
const detailedExpenses = [
  { 
    category: string,
    amount: number,
    percentage: number,
    items: number,
    avgPerItem: number,
    trend: string
  }
];
```

#### الإيرادات التفصيلية
```typescript
const detailedRevenue = [
  {
    source: string,
    amount: number,
    count: number,
    avgPrice: number,
    percentage: number
  }
];
```

#### أرصدة العملاء
```typescript
const customersBalances = [
  {
    name: string,
    balance: number,
    paid: number,
    total: number,
    status: string,
    overdue: number
  }
];
```

#### أرصدة الموردين
```typescript
const suppliersBalances = [
  {
    name: string,
    balance: number,
    paid: number,
    total: number,
    status: string,
    overdue: number
  }
];
```

#### مراكز التكلفة
```typescript
const costCentersData = [
  {
    batch: string,
    animals: number,
    revenue: number,
    expenses: number,
    profit: number,
    margin: number
  }
];
```

---

## 📊 الإحصائيات والأرقام الرئيسية

### الملخص المالي العام
```
إجمالي الإيرادات:     465,000 ج
إجمالي المصروفات:     360,000 ج
صافي الربح:           105,000 ج
هامش الربح:          22.6%

إجمالي الأصول:       2,105,000 ج
إجمالي الخصوم:       595,000 ج
حقوق الملكية:        1,510,000 ج

النقدية المتاحة:     150,000 ج
ذمم مدينة (عملاء):   85,000 ج
ذمم دائنة (موردين):  120,000 ج
```

### المؤشرات المالية (KPIs)
- **نسبة السيولة السريعة:** (150,000 + 85,000) / 195,000 = 1.21
- **نسبة السيولة الجارية:** 455,000 / 195,000 = 2.33
- **نسبة المديونية:** 595,000 / 2,105,000 = 28.3%
- **العائد على حقوق الملكية (ROE):** 105,000 / 1,510,000 = 6.95%
- **العائد على الأصول (ROA):** 105,000 / 2,105,000 = 4.99%

---

## 🔄 التكامل مع النظام

### الصفحات المرتبطة
1. **Customers.tsx** - إدارة العملاء
2. **Suppliers.tsx** - إدارة الموردين
3. **Expenses.tsx** - إدارة المصروفات
4. **Transactions.tsx** - المعاملات المالية
5. **PaymentVoucher.tsx** - إيصالات الصرف
6. **ReceiptVoucher.tsx** - إيصالات الاستلام
7. **JournalEntries.tsx** - سندات القيد
8. **CostCenter.tsx** - إدارة مراكز التكلفة

### التوجيه (Routing)
```typescript
<Route path="/financial-reports" component={<FinancialReports />} />
```

### القائمة الجانبية (Sidebar)
```typescript
{
  title: "التقارير المالية",
  url: "/financial-reports",
  icon: FileBarChart,
  badge: "8" // عدد التقارير
}
```

---

## 🎯 حالات الاستخدام

### 1. المدير المالي
- **مراجعة أداء الربحية:** قائمة الدخل
- **تحليل الوضع المالي:** الميزانية العمومية
- **متابعة السيولة:** التدفقات النقدية

### 2. المدير التنفيذي
- **اتخاذ قرارات استراتيجية:** جميع التقارير
- **تقييم الاستثمارات:** مراكز التكلفة
- **مراقبة الأداء:** المصروفات والإيرادات التفصيلية

### 3. المحاسب
- **متابعة التحصيلات:** أرصدة العملاء
- **إدارة المدفوعات:** أرصدة الموردين
- **مراجعة الحسابات:** جميع التقارير

### 4. صاحب المزرعة
- **معرفة صافي الربح:** قائمة الدخل
- **تقييم القيمة الصافية:** الميزانية العمومية
- **مراقبة النقدية:** التدفقات النقدية

---

## 🚀 التطويرات المستقبلية

### مرحلة 1: الربط بقاعدة البيانات
- [ ] استبدال البيانات الثابتة ببيانات حقيقية من API
- [ ] إنشاء React Query hooks للتقارير
- [ ] إضافة Loading States و Error Handling
- [ ] التحديث التلقائي للبيانات

### مرحلة 2: ميزات التصدير والطباعة
- [ ] تصدير إلى Excel بتنسيق احترافي
- [ ] تصدير إلى PDF
- [ ] طباعة مع تخطيط مخصص
- [ ] حفظ التقارير المفضلة

### مرحلة 3: المقارنات والرسوم البيانية
- [ ] مقارنة فترات زمنية مختلفة
- [ ] رسوم بيانية تفاعلية (Charts.js / Recharts)
- [ ] Trend Analysis (تحليل الاتجاهات)
- [ ] Forecasting (التنبؤات)

### مرحلة 4: التخصيص والجدولة
- [ ] تخصيص التقارير حسب احتياجات المستخدم
- [ ] جدولة إرسال التقارير بالبريد الإلكتروني
- [ ] Dashboards مخصصة
- [ ] تنبيهات تلقائية للمؤشرات الحرجة

### مرحلة 5: التحليل المتقدم
- [ ] تحليل ABC للمخزون
- [ ] تحليل Pareto للمصروفات
- [ ] Break-Even Analysis
- [ ] Ratio Analysis (تحليل النسب المالية)

---

## 📱 واجهة المستخدم

### الهيدر
```
📊 التقارير المالية
تقارير شاملة ومفصلة عن الأداء المالي للمزرعة

[طباعة] [تصدير Excel]
```

### الفلاتر
```
[الفترة: هذا الشهر ▼] [نوع التقرير: قائمة الدخل ▼]
```

### Grid Cards (8 بطاقات ملونة)
```
┌─────────────────┬─────────────────┬─────────────────┬─────────────────┐
│ قائمة الدخل     │ الميزانية       │ التدفقات النقدية│ المصروفات       │
│ 🟢 الأرباح     │ 🔵 الأصول      │ 🟣 النقدية      │ 🟠 التحليل      │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
┌─────────────────┬─────────────────┬─────────────────┬─────────────────┐
│ الإيرادات       │ أرصدة العملاء  │ أرصدة الموردين  │ مراكز التكلفة   │
│ 🟢 المبيعات    │ 🔵 المستحقات   │ 🔴 المديونيات   │ 🟣 الربحية     │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```

### Tabs للتنقل
```
[قائمة الدخل] [الميزانية] [التدفقات] [المصروفات] [الإيرادات] [العملاء] [الموردين] [مراكز التكلفة]
```

---

## 🔧 إرشادات الصيانة

### تحديث البيانات
```typescript
// استبدال البيانات الثابتة بـ API calls
const { data: profitLossData, isLoading } = useQuery({
  queryKey: ['profitLoss', selectedPeriod],
  queryFn: () => fetchProfitLossReport(selectedPeriod)
});
```

### إضافة تقرير جديد
1. إضافة التقرير في مصفوفة `reports`
2. إنشاء `TabsContent` جديد
3. تصميم بنية البيانات
4. إضافة الأيقونة المناسبة
5. اختيار اللون المميز

### تخصيص الألوان
```css
.profit-card { @apply bg-green-500; }
.loss-card { @apply bg-red-500; }
.asset-card { @apply bg-blue-500; }
.liability-card { @apply bg-orange-500; }
```

---

## ✅ الخلاصة

تم تطوير **نظام التقارير المالية** بنجاح بـ **8 تقارير شاملة** تغطي جميع جوانب الأداء المالي:

✅ **قائمة الدخل** - تحليل الربحية  
✅ **الميزانية العمومية** - الوضع المالي  
✅ **التدفقات النقدية** - حركة النقد  
✅ **المصروفات التفصيلية** - تحليل التكاليف  
✅ **الإيرادات التفصيلية** - مصادر الدخل  
✅ **أرصدة العملاء** - المستحقات  
✅ **أرصدة الموردين** - المديونيات  
✅ **مراكز التكلفة** - ربحية الدفعات  

**التقنيات المستخدمة:**
- React 18 + TypeScript
- shadcn/ui Components
- Lucide React Icons
- Tailwind CSS
- Responsive Design

**الحالة:** ✅ **جاهز للاستخدام والاختبار**

---

**آخر تحديث:** 11 أكتوبر 2025  
**الإصدار:** v1.0.0  
**المطور:** FarmDreamERP Team 🚜
