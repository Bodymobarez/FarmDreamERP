# تحديث صفحة تسجيل الأوزان - Weights Page Update

## نظرة عامة
تم تطوير صفحة تسجيل الأوزان بالكامل لتوفير نظام شامل لمتابعة أوزان الحيوانات ومعدلات النمو مع تقارير تفصيلية لكل حيوان.

## المميزات الرئيسية

### 1. لوحة الإحصائيات (Statistics Dashboard)
تعرض 4 بطاقات رئيسية:
- **إجمالي الحيوانات**: عدد الحيوانات الكلي وعدد النشط منها
- **متوسط الوزن الحالي**: متوسط وزن جميع الحيوانات
- **متوسط الزيادة**: متوسط زيادة الوزن منذ الدخول
- **معدل النمو**: متوسط معدل الزيادة اليومية (ADG) التقريبي

### 2. عرض سجلات الأوزان (Weight Records Table)
جدول شامل يعرض:
- رقم الأذن (Ear Tag)
- نوع الحيوان
- الجنس
- العنبر (Pen)
- وزن الدخول
- الوزن الحالي
- الزيادة في الوزن (بألوان مميزة)
- معدل الزيادة اليومية (ADG - Average Daily Gain)
- الحالة (نشط/مباع)
- زر عرض التفاصيل لكل حيوان

### 3. الفلاتر والبحث (Filters & Search)
- **البحث**: البحث برقم الأذن
- **فلتر النوع**: تصفية حسب نوع الحيوان (عجول، أبقار، إلخ)
- تحديث فوري للنتائج

### 4. نافذة التفاصيل المنبثقة (Details Dialog)
عند النقر على "عرض التفاصيل" لأي حيوان، تظهر نافذة شاملة تحتوي على:

#### أ. بطاقات الملخص (Summary Cards)
- النوع
- وزن الدخول
- الوزن الحالي
- إجمالي الزيادة

#### ب. جدول سجل الأوزان (Weight History Table)
جدول تفصيلي يعرض مراحل وزن الحيوان:
- **التاريخ**: تاريخ كل قياس
- **الأيام المنقضية**: عدد الأيام من تاريخ الدخول
- **الوزن**: الوزن في ذلك التاريخ
- **الزيادة الأسبوعية**: زيادة الوزن خلال الأسبوع
- **معدل الزيادة اليومية**: متوسط الزيادة اليومية (ADG)
- **الزيادة التراكمية**: إجمالي الزيادة منذ الدخول

#### ج. تحليل الأداء (Performance Analysis)
3 بطاقات تحليلية:
- **معدل الزيادة اليومية (ADG)**: بالكيلوجرام/يوم
- **نسبة الزيادة**: النسبة المئوية لزيادة الوزن
- **عدد القياسات**: عدد مرات قياس الوزن

### 5. وظائف التصدير (Export Functions)
- **تصدير القائمة الرئيسية**: 
  - PDF: تقرير شامل بجميع الحيوانات
  - Excel: جدول بيانات قابل للتعديل
  - CSV: ملف CSV للاستخدام في برامج أخرى

- **تصدير تقرير فردي**: 
  - تصدير تقرير PDF مفصل لكل حيوان يحتوي على سجل الأوزان الكامل

## التفاصيل التقنية

### 1. معادلات الحساب

#### Average Daily Gain (ADG)
```typescript
ADG = (الوزن الحالي - وزن الدخول) / عدد الأيام منذ الدخول
```

#### معدل الزيادة الأسبوعية
```typescript
Weekly Gain = ADG × 7
```

#### الزيادة التراكمية
```typescript
Cumulative Gain = الوزن الحالي - وزن الدخول
```

#### نسبة الزيادة
```typescript
Growth Percentage = ((الوزن الحالي - وزن الدخول) / وزن الدخول) × 100
```

### 2. توليد سجل الأوزان (Weight History Generation)

نظرًا لعدم وجود جدول `animalWeights` في قاعدة البيانات حاليًا، يتم توليد سجل الأوزان بشكل تقديري:

```typescript
const generateWeightHistory = (animal) => {
  // حساب الزيادة اليومية
  const dailyGain = (currentWeight - entryWeight) / daysSinceEntry;
  
  // توليد قياسات أسبوعية
  for (let i = 0; i <= weeks; i++) {
    const daysElapsed = i * 7;
    const weight = entryWeight + (dailyGain * daysElapsed);
    // ... إضافة القياس للسجل
  }
}
```

### 3. مصدر البيانات
```typescript
// Fetch from animals API
const { data: animals = [], isLoading } = useQuery({
  queryKey: ["/api/animals"],
});
```

### 4. الحالات المعالجة
- ✅ Loading state: عرض رسالة "جاري تحميل البيانات"
- ✅ Empty state: عرض رسالة "لا توجد حيوانات مسجلة"
- ✅ Filtered results: التحديث الفوري حسب الفلاتر
- ✅ No weight gain: معالجة الحالات التي لا توجد فيها زيادة

## استخدام الصفحة

### عرض جميع الأوزان
1. افتح صفحة "تسجيل الأوزان" من القائمة الجانبية
2. ستظهر الإحصائيات في الأعلى
3. استعرض جدول جميع الحيوانات مع أوزانهم الحالية

### البحث والفلترة
1. استخدم حقل البحث للبحث برقم الأذن
2. استخدم قائمة النوع لتصفية حسب نوع معين
3. النتائج تتحدث فوريًا

### عرض تفاصيل حيوان معين
1. انقر على زر "عرض التفاصيل" بجوار أي حيوان
2. ستظهر نافذة منبثقة تحتوي على:
   - ملخص الأوزان
   - سجل الأوزان التفصيلي (أسبوعي)
   - تحليل الأداء
3. يمكنك تصدير تقرير الحيوان من هذه النافذة

### التصدير
#### تصدير القائمة الكلية:
- انقر على زر PDF/Excel/CSV في رأس الجدول
- سيتم تنزيل الملف تلقائيًا

#### تصدير تقرير فردي:
- افتح تفاصيل الحيوان
- انقر على "تصدير التقرير"
- سيتم تنزيل PDF يحتوي على سجل الأوزان الكامل

## الملفات المعدلة

### client/src/pages/Weights.tsx
**التغييرات:**
- ✅ إضافة بطاقات الإحصائيات (4 cards)
- ✅ جدول شامل بجميع بيانات الأوزان
- ✅ نظام البحث والفلترة
- ✅ نافذة التفاصيل المنبثقة
- ✅ جدول سجل الأوزان التفصيلي
- ✅ دالة توليد سجل الأوزان `generateWeightHistory()`
- ✅ دالة حساب ADG `calculateADG()`
- ✅ وظائف التصدير (PDF/Excel/CSV)
- ✅ تحليل الأداء
- ✅ معالجة حالات التحميل والفراغ

**الأكواد الرئيسية:**
```typescript
// Statistics calculation
const stats = {
  totalAnimals: animals.length,
  activeAnimals: animals.filter(a => a.status === "نشط").length,
  avgCurrentWeight: ...,
  avgWeightGain: ...,
};

// ADG calculation
const calculateADG = (animal) => {
  const gain = currentWeight - entryWeight;
  const days = daysSinceEntry;
  return (gain / days).toFixed(2);
};

// Weight history generation
const generateWeightHistory = (animal) => {
  // توليد قياسات أسبوعية من الدخول حتى الآن
  // حساب الزيادة الأسبوعية والتراكمية
};
```

## مميزات إضافية

### 1. الألوان التفاعلية
- 🟢 الزيادة الموجبة: أخضر
- 🔵 معدل ADG: أزرق
- ⚪ القيم الصفرية: رمادي

### 2. الأيقونات التوضيحية
- 📦 Package: إجمالي الحيوانات
- ⚖️ Scale: الأوزان
- 📈 TrendingUp: الزيادة
- 📊 Activity: معدل النمو
- 👁️ Eye: عرض التفاصيل
- 📅 Calendar: التواريخ

### 3. الاستجابة (Responsive)
- تخطيط متجاوب على جميع الأحجام
- البطاقات تتوزع بشكل مناسب (4 على الشاشات الكبيرة، 1-2 على الصغيرة)
- جدول قابل للتمرير على الشاشات الصغيرة

## ملاحظات مهمة

### ⚠️ البيانات التجريبية
حاليًا، يتم **توليد سجل الأوزان بشكل تقديري** لأن:
- لا يوجد جدول `animalWeights` في قاعدة البيانات
- المتوفر فقط: `entryWeight` و `currentWeight` في جدول `animals`

### 🔮 للاستخدام الفعلي (Production)
يُنصح بإضافة جدول لتسجيلات الأوزان:

```typescript
// Schema suggestion
export const animalWeights = pgTable("animal_weights", {
  id: varchar("id").primaryKey(),
  animalId: varchar("animal_id").notNull(),
  weightDate: timestamp("weight_date").notNull(),
  weight: decimal("weight", { precision: 10, scale: 2 }).notNull(),
  notes: text("notes"),
  recordedBy: varchar("recorded_by"),
  createdAt: timestamp("created_at").notNull(),
});
```

ثم إضافة API endpoints:
- `GET /api/animal-weights/:animalId` - جلب سجل أوزان حيوان
- `POST /api/animal-weights` - إضافة قياس وزن جديد
- `DELETE /api/animal-weights/:id` - حذف قياس

## الخلاصة

تم تطوير صفحة تسجيل الأوزان بنجاح لتصبح:
- ✅ نظام شامل لمتابعة أوزان الحيوانات
- ✅ تقارير تفصيلية لكل حيوان تظهر مراحل النمو
- ✅ حسابات دقيقة لمعدلات الزيادة (ADG)
- ✅ إحصائيات شاملة
- ✅ وظائف تصدير متعددة
- ✅ واجهة سهلة الاستخدام
- ✅ تصميم متجاوب

الصفحة جاهزة للاستخدام الفوري، ويمكن تحسينها لاحقًا بإضافة جدول تسجيلات الأوزان الفعلية.
